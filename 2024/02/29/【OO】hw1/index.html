<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="孩子不懂事乱写的">
<meta property="og:type" content="article">
<meta property="og:title" content="【OO】hw1">
<meta property="og:url" content="http://example.com/2024/02/29/%E3%80%90OO%E3%80%91hw1/index.html">
<meta property="og:site_name" content="碳罐堆积处">
<meta property="og:description" content="孩子不懂事乱写的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/%E3%80%90OO%E3%80%91hw1/image-20240322105141017.png">
<meta property="og:image" content="http://example.com/images/%E3%80%90OO%E3%80%91hw1/image-20240322105856255.png">
<meta property="article:published_time" content="2024-02-29T15:08:15.000Z">
<meta property="article:modified_time" content="2024-04-19T02:07:01.973Z">
<meta property="article:author" content="Carbon">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/%E3%80%90OO%E3%80%91hw1/image-20240322105141017.png">


<link rel="canonical" href="http://example.com/2024/02/29/%E3%80%90OO%E3%80%91hw1/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2024/02/29/%E3%80%90OO%E3%80%91hw1/","path":"2024/02/29/【OO】hw1/","title":"【OO】hw1"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【OO】hw1 | 碳罐堆积处</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">碳罐堆积处</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E5%8F%8A%E4%BC%98%E5%8C%96"><span class="nav-number">1.</span> <span class="nav-text">架构及优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%9C%E4%B8%9A"><span class="nav-number">1.1.</span> <span class="nav-text">第一次作业</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%AA%81%E7%A0%B4%E5%8F%A3"><span class="nav-number">1.1.1.</span> <span class="nav-text">一、突破口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%AC%A6%E5%8F%B7%E5%88%86%E6%9E%90"><span class="nav-number">1.1.2.</span> <span class="nav-text">二、符号分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%AE%A1%E7%AE%97"><span class="nav-number">1.1.3.</span> <span class="nav-text">三、计算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A"><span class="nav-number">1.2.</span> <span class="nav-text">第二次作业</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="nav-number">1.2.1.</span> <span class="nav-text">一、自定义函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%8C%87%E6%95%B0%E5%87%BD%E6%95%B0"><span class="nav-number">1.2.2.</span> <span class="nav-text">二、指数函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E4%BD%9C%E4%B8%9A"><span class="nav-number">1.3.</span> <span class="nav-text">第三次作业</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">一、自定义函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%B1%82%E5%AF%BC"><span class="nav-number">1.3.2.</span> <span class="nav-text">二、求导</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%BA%A6%E9%87%8F%E5%88%86%E6%9E%90"><span class="nav-number">1.3.3.</span> <span class="nav-text">三、度量分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">2.</span> <span class="nav-text">测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#bug"><span class="nav-number">2.1.</span> <span class="nav-text">bug</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E4%B8%80%E5%8F%91%E8%80%8C%E7%89%B5%E5%85%A8%E8%BA%AB"><span class="nav-number">2.1.1.</span> <span class="nav-text">动一发而牵全身</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%9B%E5%8D%9A%E9%97%B9%E9%AC%BC"><span class="nav-number">2.1.2.</span> <span class="nav-text">赛博闹鬼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A9%BA%EF%BC%9F"><span class="nav-number">2.2.</span> <span class="nav-text">空？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="nav-number">2.3.</span> <span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BF%83%E5%BE%97%E5%8F%8A%E5%BB%BA%E8%AE%AE"><span class="nav-number">3.</span> <span class="nav-text">心得及建议</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Carbon</p>
  <div class="site-description" itemprop="description">还没想出高级的博客名；出现问题欢迎交流指正喵。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/02/29/%E3%80%90OO%E3%80%91hw1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Carbon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="碳罐堆积处">
      <meta itemprop="description" content="还没想出高级的博客名；出现问题欢迎交流指正喵。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="【OO】hw1 | 碳罐堆积处">
      <meta itemprop="description" content="孩子不懂事乱写的">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【OO】hw1
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-02-29 23:08:15" itemprop="dateCreated datePublished" datetime="2024-02-29T23:08:15+08:00">2024-02-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-19 10:07:01" itemprop="dateModified" datetime="2024-04-19T10:07:01+08:00">2024-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OO/" itemprop="url" rel="index"><span itemprop="name">OO</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">孩子不懂事乱写的</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="架构及优化"><a href="#架构及优化" class="headerlink" title="架构及优化"></a>架构及优化</h1><h2 id="第一次作业"><a href="#第一次作业" class="headerlink" title="第一次作业"></a>第一次作业</h2><h3 id="一、突破口"><a href="#一、突破口" class="headerlink" title="一、突破口"></a>一、突破口</h3><p>本次作业思路绝大部分来源训练代码。</p>
<p>训练代码主要干了三件事：</p>
<ul>
<li>拆解表达式token</li>
<li>递归解析</li>
<li>化简</li>
<li>输出</li>
</ul>
<p>前面三步基本上都能套训练代码，所以问题的关键便在于<strong>如何化简</strong>，或者说<strong>如何计算</strong>。</p>
<p>如果是面向过程编程，可能需要写很多方法，并且按情况讨论：常数×常数，常数×变量，变量×变量，常数×表达式……</p>
<p>然而，要想简化计算，在这里希望将待计算的对象统一，这样只需写少量方法，即可适用于所有计算。</p>
<p>本次作业规定的形式化表述限制较多，因此可以将变量因子和常数因子写成<code>S M * x ^ E</code>的形式，统一申明为<code>Powerfun</code>类，其中<code>S</code>为符号，对于变量因子<code>M=1</code>；对于常数，<code>E=0</code>。</p>
<p>对于表达式因子，去括号操作后依然可以转为变量因子和常数因子。</p>
<h3 id="二、符号分析"><a href="#二、符号分析" class="headerlink" title="二、符号分析"></a>二、符号分析</h3><p>本次作业还有一个需要格外注意的问题是<del>纷繁复杂</del>的符号。</p>
<p>对于<code>-1-2</code>的式子，将其视为<code>-1+ -2</code>，可以发现实际上<code>Expr</code>和<code>Term</code>并不需要符号的概念，也不需要记录<code>Expr</code>中的加减运算符，因为<strong>所有的符号都落在<code>S</code>中</strong>，进而可以默认<code>Expr</code>的连接方式都是加法。</p>
<p>可以这样修改递归解析的函数。</p>
<p><code>parseExpr()</code>伪代码</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">boolen <span class="keyword">tag</span> <span class="title">= true</span>;</span><br><span class="line"></span><br><span class="line">//如果一开始识别到符号，直接读给Expr</span><br><span class="line">if (<span class="string">"+"</span> || <span class="string">"-"</span>) {</span><br><span class="line">	next();</span><br><span class="line">	if (<span class="string">"-"</span>) {</span><br><span class="line">		<span class="keyword">tag</span> <span class="title">= false</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">getFirstTerm();</span><br><span class="line"></span><br><span class="line">//如果之前读到负号，则改变第一个Term的符号</span><br><span class="line">if (!<span class="keyword">tag</span>) {</span><br><span class="line">	FirstTerm().vertSign();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>parseTerm()</code>同上</p>
<p>由于<code>Expr</code>、<code>Term</code>、<code>Powerfun</code>都是<code>Factor</code>的实现，所以可以直接给<code>Factor</code>接口加上<code>vertSign()</code>方法。</p>
<ul>
<li><p><code>Term</code>的<code>vertSign()</code>指递归调用第一个<code>Factor</code>的<code>vertSign()</code>。</p>
</li>
<li><p><code>Powerfun</code>的<code>vertSign()</code>是翻转<code>sign</code>属性。</p>
</li>
<li><p><code>Expr</code>有些特殊，要调用他的<code>vertSign()</code>方法实际上由是<code>Term</code>递归下来的翻转表达式因子，因此要对其中每一个<code>Term</code>再递归调用翻转，而不是仅翻转第一个<code>Term</code>。</p>
</li>
</ul>
<h3 id="三、计算"><a href="#三、计算" class="headerlink" title="三、计算"></a>三、计算</h3><p><strong>问题</strong></p>
<p>在测试最初版代码时，发现针对部分表达式会出现速度极其缓慢甚至内存溢出的情况。互测中发现部分同学也存在同样的事情。虽然由于数据的限制应该不会在这个方面卡住，但还是值得优化的。窃以为问题大多数出在<strong>计算</strong>上，因为本人只是修改了计算的逻辑程序性能就得到肉眼可见的提升。</p>
<p><strong>最初思路</strong></p>
<p>最开始，我计算的方法是<em>将所有的式子展开</em>，如<code>x^2</code>会展成<code>x*x</code>，而<code>(x+1)*(x+2)*2</code>就会先展开成<code>x*(x+2)*2 + 1*(x+2)*2</code>，再展开成<code>x*x*2 + x*2*2 + 1*x*2 + 1*2*2</code>。虽然这样可以保证思路的简单粗暴，但是浪费了太多空间和时间。并且如果按照这样的思路展开，项展开后可能是<code>Powerfun</code>（<code>(x)-&gt;x</code>），也可能是<code>Term</code>（<code>(x)^2 -&gt; x*x</code>），还有可能是<code>Expr</code>（<code>(x+1)*2 -&gt; x*2+1*2</code>），还是很复杂的</p>
<p><strong>优化</strong></p>
<p>经过zyt佬的指点后，发现更优的做法是新建一个<code>Poly</code>类，该类包含<code>Powerfun</code>的集合（本人的<code>Powerfun</code>应该和部分同学设计中的<code>Mono</code>相同）。这样只需要给<code>Expr</code>、<code>Term</code>、<code>Powerfun</code>都增加<code>toPoly()</code>的方法，将复杂的类型转换转为同一种<code>Poly</code>。经过层层调用，最后会得到唯一的一个<code>Poly</code>，再调用其<code>toString()</code>方法即可。</p>
<p><strong>实现方法</strong></p>
<p>运算的基础是<code>Powerfun</code>，所以其需要有加法和乘法两种运算方式。</p>
<p>在实现的过程中，我给<code>Poly</code>也加上了“加法”和乘法两种运算，这里的加法指合并两个<code>Poly</code>，而乘法指两个<code>Poly</code>中的<code>Powerfun</code>一一相乘再存到新的<code>Powerfun</code>中。</p>
<p>这样，<code>Expr</code>的<code>toPoly()</code>就是调用Term的函数再相加、<code>Term</code>则是调用<code>Factor</code>的函数再相加、<code>Powerfun</code>是直接创建新的<code>Poly</code>对象。</p>
<p>其中还有一个值得注意的问题是<code>Poly</code>的<code>AddPf()</code>方法需要检查该<code>Poly</code>中<strong>是否已有指数相同的pf</strong>，如果有，直接相加替换。</p>
<h2 id="第二次作业"><a href="#第二次作业" class="headerlink" title="第二次作业"></a>第二次作业</h2><h3 id="一、自定义函数"><a href="#一、自定义函数" class="headerlink" title="一、自定义函数"></a>一、自定义函数</h3><p>这个是拿到的时候最纠结的部分。关于如何实现自定义函数，设想了很多方案，敲定一种后也反复前后摇摆。最终选择是建一个类<code>Define</code>用于存储函数的定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, ArrayList&lt;String&gt;&gt; name2Paras = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, String&gt; name2String = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>利用正则表达式解析函数定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addDefine</span><span class="params">(String input)</span> {</span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">"([fgh])(\\([xyz])?(,[xyz])?(,[xyz])?(\\)=.+)"</span>);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(input);</span><br><span class="line">        <span class="keyword">if</span> (matcher.find()) {</span><br><span class="line">            ...</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>
<p>这个类核心功能就只有这两项，起到存储记录的作用。在解析目标表达式时，按照解析因子的方式解析实参，存成<code>Deffun</code>类。该类存有形参和实参的对应，并且有替换函数进行字符串层面的替换。</p>
<p>然而，替换的过程并没有在解析字符串层次上进行。再次明确整体架构：</p>
<ul>
<li>parse</li>
<li>toPoly</li>
<li>toString</li>
</ul>
<p>本次作业中选择将替换放在第二步，也就是<code>toPoly</code>的层次。当递归下降到<code>Deffun</code>的<code>toPoly</code>方法时，先进行替换，再当成新的表达式进行解析，最后才调用<code>Expr</code>的<code>toPoly</code>。这样做的好处是，实际上并没有新增很多方法，仅仅实现了信息的管理和简单的替换，而解析和打印功能都可以直接调用第一次作业的方法。</p>
<p>在具体实现上，为了避免一些隐性的问题，传参的时候手动添加括号。</p>
<h3 id="二、指数函数"><a href="#二、指数函数" class="headerlink" title="二、指数函数"></a>二、指数函数</h3><p><strong>问题</strong></p>
<p>刚开始以为指数函数相对容易实现，看起来直接更改基本项的结构即可，然而实际实施发现指数的因子会造成很多问题。指数的因子最“大”可以是表达式因子，所以基本项中增加类型为<code>Poly</code>类型。然而，第一次作业中为了优化方便，在给<code>poly</code>中添加新的<code>meta</code>时，会先遍历搜索全部<code>meta</code>，检查是否有可以合并的。在这次作业中，为了添加<code>meta</code>，需要比较<code>exp</code>的<code>poly</code>是否相同，而比较<code>poly</code>是否相同，最直观的方式就是比较每个<code>meta</code>是否相同……似乎到这里遇到了死循环，并且<code>poly</code>中挨个比较也并不是很容易实现的事情。</p>
<p><strong>优化</strong></p>
<p>核心问题还是如何判断<code>meta</code>中的<code>poly</code>是否相等，其实等价为<strong>两个<code>poly</code>相减是否为0</strong>，而相减其实就是改一下相加的方法，进一步就是更改<strong>可加</strong>的判断。判断两个是否可加，可以先从最基本的情况开始，如是否为单纯数字，或单纯幂函数等，最后才相减判断是否相等。这样就可以保证最终一定会到达调用底部，并且完美地解决了判断相等的问题。</p>
<p><strong>细节</strong></p>
<p>有几点在实现的过程中需要注意，首先是自定义函数的传参。由于我初始自定义函数传参逻辑是：挨个查找每个字符，如果这个字符是形参（x,y,z)，就替换成对应的实参。然而对于指数函数的<code>exp</code>，如果不加处理会出现<code>e(x^2)p</code>这种令人小脑萎缩的情况。</p>
<p>以及在化简的时候，对<code>exp</code>里的内容需要进行删括号的操作，最初我忘记了符号问题，仅仅记得判断<code>exp((x))</code>要改成<code>exp(x)</code>，而忘记了<code>exp((-x))</code>的括号不能去。</p>
<h2 id="第三次作业"><a href="#第三次作业" class="headerlink" title="第三次作业"></a>第三次作业</h2><p>本次作业整体相对简单，然而由于第二次作业里存在一些历史遗留问题导致花费很多时间修改之前的代码，具体问题留在测试部分细说。</p>
<h3 id="一、自定义函数-1"><a href="#一、自定义函数-1" class="headerlink" title="一、自定义函数"></a>一、自定义函数</h3><p>本次作业中对于自定义函数的限定放宽，现允许在定义中出现之前已经出现的定义函数。</p>
<h3 id="二、求导"><a href="#二、求导" class="headerlink" title="二、求导"></a>二、求导</h3><p>再次感谢课程组提供的实验代码，求导功能的实现依旧来源于实验代码给的启发。在解析中如果遇到求导因子，则将需要求导的表达式存起来，在<code>toPoly</code>的时候再迭代下去求导。由于几乎所有基本结构都是<code>Factor</code>的实现，所以也就是给<code>Factor</code>新增<code>derive()</code>方法，加起来也很方便。</p>
<h3 id="三、度量分析"><a href="#三、度量分析" class="headerlink" title="三、度量分析"></a>三、度量分析</h3><p>方法</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>method</th>
<th>CogC</th>
<th>ev(G)</th>
<th>iv(G)</th>
<th>v(G)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total</td>
<td>198.0</td>
<td>127.0</td>
<td>202.0</td>
<td>218.0</td>
</tr>
<tr>
<td>Average</td>
<td>2.475</td>
<td>1.5875</td>
<td>2.525</td>
<td>2.725</td>
</tr>
</tbody>
</table>
</div>
<p>类</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>class</th>
<th>OCavg</th>
<th>OCmax</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Deffun</td>
<td>1.5</td>
<td>5.0</td>
<td>12.0</td>
</tr>
<tr>
<td>Define</td>
<td>1.75</td>
<td>4.0</td>
<td>7.0</td>
</tr>
<tr>
<td>Derive</td>
<td>1.0</td>
<td>1.0</td>
<td>5.0</td>
</tr>
<tr>
<td>Expr</td>
<td>1.4444444444444444</td>
<td>2.0</td>
<td>13.0</td>
</tr>
<tr>
<td>Lexer</td>
<td>2.6</td>
<td>5.0</td>
<td>13.0</td>
</tr>
<tr>
<td>MainClass</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Meta</td>
<td>1.5294117647058822</td>
<td>5.0</td>
<td>26.0</td>
</tr>
<tr>
<td>Parser</td>
<td>4.7</td>
<td>9.0</td>
<td>47.0</td>
</tr>
<tr>
<td>Poly</td>
<td>3.1333333333333333</td>
<td>10.0</td>
<td>47.0</td>
</tr>
<tr>
<td>Term</td>
<td>2.1666666666666665</td>
<td>5.0</td>
<td>13.0</td>
</tr>
<tr>
<td>Total</td>
<td></td>
<td></td>
<td>185.0</td>
</tr>
<tr>
<td>Average</td>
<td>2.3125</td>
<td>4.8</td>
<td>18.5</td>
</tr>
</tbody>
</table>
</div>
<p>类结构</p>
<p><img src="/images/【OO】hw1/image-20240322105141017.png" alt="image-20240322105141017"></p>
<p>方法</p>
<p><img src="/images/【OO】hw1/image-20240322105856255.png" alt="image-20240322105856255"></p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h2><p>这几次作业实现中除了一些常见的若智bug，还有一些困扰我很久也很有价值<del>也很难de</del>的bug</p>
<h3 id="动一发而牵全身"><a href="#动一发而牵全身" class="headerlink" title="动一发而牵全身"></a>动一发而牵全身</h3><p>在第一次作业实现中，我发现一个奇怪的事情。在符号处理的时候，对于<code>Term</code>类型，我想要翻转第一项<code>Factor</code>的符号，然而宏观上发现并没有更改。逐步debug发现并不是没有更改，而是所有项的符号都更改了，进一步查看，所有项的地址竟然相同。</p>
<p>是深浅克隆问题！在写的时候我其实注意到深浅克隆的问题，甚至为了避免浅克隆自己写了一个<code>myClone</code>方法，没想到实际上所写的克隆方法也是浅克隆……</p>
<p>后来在研讨课上发现也有同学在整个实现过程中没有深浅克隆的问题。归根结底还是自己对象太乱了，比如如果两个<code>meta</code>可以相加，应该直接返回一个新的<code>meta</code>，而不是“把一个加到另一个上面”。并且有的计算是更改对象本身，有的计算又是返回新的对象，容易乱套。</p>
<h3 id="赛博闹鬼"><a href="#赛博闹鬼" class="headerlink" title="赛博闹鬼"></a>赛博闹鬼</h3><p>第二次作业中出现了更加离谱的事情，即每次调试时结果不一样。后来发现是因为IDEA显示结果实际上是调用<code>toString</code>方法，而如果在<code>toString</code>中会更改对象内容就会造成调试结果不一致的情况。这也警戒在编写的时候要慎重考虑修改对象，尤其是<code>toString</code>这种帮助调试的方法不应该改变属性内容。</p>
<h2 id="空？"><a href="#空？" class="headerlink" title="空？"></a>空？</h2><p>第三次作业倒没有出现de不出的bug，但是因为一点设计导致改了很多。为了简化（也可能根本没简化到），在写的时候我给<code>poly</code>写了一个<code>isEmpty()</code>的判断方法，条件是其因子为空或为0。这样两个多项式相加且发现其中一个为空，就直接返回另一个多项式（这里其实保险来讲还是应该新建）。然而在乘法中我也这样做了，在第二次作业中神奇的通过了测试，这个0<em>x=x的bug居然在第三次作业才暴露。然而暴露的时候我已经基本上写完了，并且发现自己一直将<strong>poly为空</strong>和<em>*poly等于0</em></em>混用，导致会在各种奇怪的地方发生奇怪的事。</p>
<p>面向对象应该讲究的是低耦合，显然这个方法没有达到这个要求。在写的时候还是应该分清楚对应的情况。</p>
<h2 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h2><p>本次测试由于技术原因并没有搭建测评机，倒是写了一些辅助打包<code>jar</code>和统一喂数据等程序方便互测。测试主要还是参考了各位大佬搭建的评测机，然而发现这些评测机在数据构建上或多或少都存在一定限制，并不能完全排除问题。在互测中被各位佬奇妙的数据hack后，发现测试重点还是应该放在<strong>题目约数分析</strong>和<strong>特殊情况</strong>上。</p>
<p>在互测中，我会将自己出过错的测试数据喂给其他人观察结果，偶尔会发现同质问题。我还会阅读他人代码，将逻辑稍显混乱的和<code>if...else</code>较多的部分进行额外的检查和构造数据。</p>
<h1 id="心得及建议"><a href="#心得及建议" class="headerlink" title="心得及建议"></a>心得及建议</h1><p><strong>心得</strong></p>
<ol>
<li>还是要尽早开始写，写了一份出来要debug，如果架构不好还得重构……</li>
<li>在完成某项功能的时候需要主动转换思维方式，思考如何从面向对象的角度更优雅地解决问题。如本次作业中每一次想要自己手动分类特判的时候都发现交给递归下降是更好的选择。</li>
<li>评测机还是方便的，自己需要学习搭一下。但是也不能完全信任评测机，评测机的测试强度和编写者有很大关系，如果作者不认为某个点是需要额外注意的部分，而你正好在这里错了，就会发生惨案。</li>
</ol>
<p><strong>建议</strong></p>
<ul>
<li>对部分数据放宽性能限制，避免不必要的性能内卷ono</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Carbon
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://example.com/2024/02/29/%E3%80%90OO%E3%80%91hw1/" title="【OO】hw1">http://example.com/2024/02/29/【OO】hw1/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/01/20/MCM/" rel="prev" title="MCM">
                  <i class="fa fa-angle-left"></i> MCM
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/03/24/%E3%80%90OS%E3%80%91lab1/" rel="next" title="【OS】lab1">
                  【OS】lab1 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Carbon</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
